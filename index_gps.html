<!DOCTYPE html>
<html>
  <head>
    <title>Vídeo em Realidade Aumentada com Autoplay</title>
    <meta name="description" content="Vídeo que inicia automaticamente ao entrar no modo AR.">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene webxr="requiredFeatures: hit-test, local-floor;" renderer="colorManagement: true">
      
      <a-assets>
        <video id="meu-video" src="vid02.webm" autoplay loop muted crossorigin="anonymous" playsinline></video>
        </a-assets>

      <a-video 
        src="#meu-video"
        width="1.6" 
        height="0.9" 
        position="0 0 -1">
      </a-video>

      <a-sky color="#ECECEC"></a-sky>
      <a-light type="ambient" color="#FFF"></a-light>
    </a-scene>

    <div style="position: absolute; bottom: 20px; width: 100%; text-align: center; z-index: 1;">
        <button id="enter-ar-button" style="padding: 12px 20px; font-size: 18px;">Iniciar AR</button>
    </div>

    <script>
      // Aguarda o conteúdo da página carregar
      document.addEventListener('DOMContentLoaded', () => {
        const sceneEl = document.querySelector('a-scene');
        const buttonEl = document.getElementById('enter-ar-button');
        
        // Pega a referência direta ao elemento <video> nos assets
        const videoEl = document.querySelector('#meu-video');

        // Adiciona um "ouvinte" para o evento 'enter-vr', que é disparado
        // quando o modo AR/VR é iniciado com sucesso.
        sceneEl.addEventListener('enter-vr', () => {
          // Assim que entrar no modo AR, manda o vídeo tocar.
          // O método .play() retorna uma Promise.
          const playPromise = videoEl.play();

          if (playPromise !== undefined) {
            playPromise.then(_ => {
              // Autoplay iniciado com sucesso!
              console.log("Vídeo iniciado automaticamente ao entrar em AR.");
            }).catch(error => {
              // Autoplay foi bloqueado.
              console.error("Não foi possível iniciar o vídeo:", error);
            });
          }
        });

        // Este trecho continua igual, gerenciando a visibilidade do botão
        if (sceneEl.is('ar-mode')) {
          buttonEl.style.display = 'none';
        }

        buttonEl.addEventListener('click', () => {
          if (sceneEl.is('ar-mode')) {
            sceneEl.exitVR();
          } else {
            sceneEl.enterVR();
          }
        });
      });
    </script>
  </body>
</html>
